<!DOCTYPE html>
<html>
<head>
<style>
.button {
	border-radius: 3px; 
	-moz-border-radius: 3px;
	background: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#ddd));
	background: -moz-linear-gradient(top, #fff, #ddd);
	border: 1px solid #bbb;
}

.button:active {
	background: -webkit-gradient(linear, left top, left bottom, from(#aaa), to(#333));
	background: -moz-linear-gradient(bottom, #ddd, #aaa);
}

#wrap {
	width: 800px;
	margin: 0 auto;
	background: #EEEEEE;
}

#main {
	float: left;
	width: 300px;
	margin: 0 auto;
	background: #FFFFFF;
}
</style>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EonDice</title>
</head>

<body>
<div id="wrap">
    <h2>EonDice</h2>
    <div id="main">
        <div>
            <label for="name">Visningsnamn:</label>
            <input type="text" id="name" size="20" value="SL"/>
        </div>
        <div>
            <textarea id="output" rows="5" cols="30" readonly>
            </textarea>
        </div>
        <br/>
        <div>
            <label for="input">n:</label>
            <input type="number" id="input" size="15" value="0"/>
        </div>
        <div class="numRow">
            <input id="K7" type="button" value="7" onclick="numKey(7);"/>
            <input id="K8" type="button" value="8" onclick="numKey(8);"/>
            <input id="K9" type="button" value="9" onclick="numKey(9);"/>
        </div>
        <div class="numRow">
            <input id="K4" type="button" value="4" onclick="numKey(4);"/>
            <input id="K5" type="button" value="5" onclick="numKey(5);"/>
            <input id="K6" type="button" value="6" onclick="numKey(6);"/>
        </div>
        <div class="numRow">
            <input id="K1" type="button" value="1" onclick="numKey(1);"/>
            <input id="K2" type="button" value="2" onclick="numKey(2);"/>
            <input id="K3" type="button" value="3" onclick="numKey(3);"/>
        </div>
        <div class="numRow">
            <input id="KC" type="button" value="C" onclick="keyC();"/>
            <input id="K0" type="button" value="0" onclick="numKey(0);"/>
            <input id="KB" type="button" value="&#x232b;" onclick="keyBackspace();"/>
        </div>
        <br/>
        <div>
            <label for="modifier">x:</label>
            <input type="number" id="modifier" size="15" value="0"/>
        </div>
        <div>
            <input id="T10" type="button" value="Slå 1T10+x" onclick="t10_button();"/>
            <input id="T6" type="button" value="Slå nT6+x" onclick="t6_button();"/>
        </div>

        <h3>Enskilda slag:</h3>
        <textarea id="debug" rows="5" cols="30" readonly>
        </textarea>
    </div>
</div>

<script>
function httpGet(theUrl) {
	var xmlHttp = null;

	xmlHttp = new XMLHttpRequest();
	xmlHttp.open("GET", theUrl, false);
	xmlHttp.send(null);

	return xmlHttp.responseText;
}

function numKey(x) {
	var inp = document.getElementById('input');
	inp.value = inp.value * 10 + x;
}

function keyC() {
	var inp = document.getElementById('input');
	inp.value = 0;
}

function keyBackspace() {
	var inp = document.getElementById('input');
	inp.value = Math.floor(inp.value / 10);
}

function t10_button() {
	roll(1, 10);
}

function t6_button() {
	var inp = document.getElementById('input');
	var n = Math.abs(inp.value);
	roll(n, 6);
}

function t10() {
	var dbg = document.getElementById('debug');
	var url = "https://www.random.org/integers/?num=1&min=1&max=10&col=1&base=10&format=plain&rnd=new";
	var roll = 0;

	dbg.value = "...";
	roll = httpGet(url);
	dbg.value = roll;

	return parseInt(roll);
}

function t6(n) {
	var dbg = document.getElementById('debug');
	var url = "";
	var sum = 0;

	var tmpDbg = "";
	var rolls = [];
	var sixes = 0;

	dbg.value = "";

	do {
		tmpDbg = dbg.value;

		if (tmpDbg === "") {
			dbg.value += "...";
		} else {
			dbg.value += "\n...";
		}

		url = "https://www.random.org/integers/?num=" + n + "&min=1&max=6&col=" + n + "&base=10&format=plain&rnd=new";
		rolls = httpGet(url).split("\t");

		for (var i = 0; i < rolls.length; i++) {
			rolls[i] = parseInt(rolls[i]);

			if (rolls[i] == 6) {
				sixes++;
			} else {
				sum += rolls[i];
			}
		}

		if (tmpDbg === "") {
			dbg.value = rolls;
		} else {
			dbg.value = tmpDbg + "\n" + rolls;
		}

		n = 2 * sixes;
		sixes = 0;
	} while (n > 0);

	return sum;
}

function roll(n, tx) {
	var nameField = document.getElementById('name');
	var modField = document.getElementById('modifier');
	var out = document.getElementById('output');

	var name = nameField.value;
	var mod = parseInt(modField.value);
	var sum = 0;

	if (tx == 10) {
		sum = t10();
	} else {
		sum = t6(n);
	}

	sum += mod;

	out.value = name + " - " + n + "T" + tx + "+" + mod + ": " + sum + "\n" + out.value;
}
</script>
</body>
</html>
